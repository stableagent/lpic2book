# 209.1. پیکربندی سرور SAMBA

## **209.1 SAMBA Server Configuration**

**وزن:** 5

**توضیحات:** داوطلبان باید بتوانند یک سرور Samba را برای کلاینت‌های مختلف تنظیم کنند. این هدف شامل تنظیم Samba به عنوان یک سرور مستقل و همچنین یکپارچه‌سازی Samba به عنوان یک عضو در یک Active Directory است. علاوه بر این، پیکربندی shareهای ساده CIFS و چاپگر پوشش داده شده است. همچنین پوشش داده شده است پیکربندی یک کلاینت لینوکس برای استفاده از یک سرور Samba. عیب‌یابی نصب‌ها نیز تست می‌شود.

**نواحی کلیدی دانش:**

* مستندات Samba 4
* فایل‌های پیکربندی Samba 4
* ابزارها و ابزارهای daemon و Samba 4
* mount کردن shareهای CIFS در لینوکس
* نگاشت نام‌های کاربر ویندوز به نام‌های کاربر لینوکس
* امنیت User-Level، Share-Level و AD

**اصطلاحات و ابزارها:**

* smbd، nmbd، winbindd
* smbcontrol، smbstatus، testparm، smbpasswd، nmblookup
* samba-tool
* net
* smbclient
* mount.cifs
* /etc/samba/
* /var/log/samba/

در روزهای قدیم آسان بود که گروهی از کامپیوترها را پیدا کنیم که فقط با هم صحبت می‌کردند و از سایر انواع کامپیوترها ایزوله بودند، اما این روزه به ندرست اتفاق می‌افتد. هرچه به عنوان یک مدیر سیستم یا مهندس، ممکن است از ما انتظار برود که بدانیم چگونه شبکه‌ای با چندین نوع سرور را تنظیم و حفظ کنیم.

دو نقش کلیدی بازیکن دنیای کامپیوترهای امروز لینوکس و مایکروسافت ویندوز هستند. آسان است که هر دو را در یک farm سرور پیدا کنیم بنابراین ما نیاز داریم در مورد برخی تفاوت‌ها و راه‌حل‌هایی که ممکن است مفید باشند بدانیم.

در این درس ما در مورد برخی تفاوت‌ها صحبت خواهیم کرد و خواهیم دیدیم که SAMBA چگونه می‌تواند به ما کمک کند. اولین تفاوت مایکروسافت در روش حل نام است.

#### حل نام NetBios

یکی از مراحل مهم در تلاش برای حل مشکلات IP تعیین این است که آیا حل نام کار می‌کند. اولین مشکل تعیین نوع نام است. در دنیای کلاینت ویندوز، دو نوع اساسی نام وجود دارد. اولین نوع نام برای آدرس‌های IP است. حل نام Host از یک فایل host و DNS برای حل استفاده می‌کند. دومین نوع نام NetBIOS name است، که برای اشتراک‌گذاری نوع (SMB) ویندوز و پیام‌رسانی استفاده می‌شود. این نام‌هایی هستند که وقتی شما یک درایو را نگاشت می‌کنید یا به یک چاپگر متصل می‌شوید استفاده می‌شوند. این نام‌ها یا با استفاده از یک فایل LMHosts روی ماشین محلی یا سرور WINS حل می‌شوند، یا با broadcast کردن یک درخواست. بیایید تصویر بزرگ حل نام ترسیم کنیم:

![](.gitbook/assets/samba-netbiosnameresolution.jpg)

ترتیب واقعاً مهم نیست و می‌تواند اصلاح شود، اما ترتیب پیش‌فرض مانند این است:

1. اولین مکانیزم حل واقعاً یک مکانیزم حل در کل نیست. این یک cache داخلی است که در هر ماشین ویندوز وجود دارد. این cache توسط تلاش‌های حل نام قبلی و توسط یک گزینه خاص در فایل LMHosts (در ادامه توصیف شده) پر می‌شود.
2. دومین روش حل جایی است که فایل LMHosts مشاوره می‌شود تا ببیند آیا نام‌های NetBIOS که با نام NetBIOS در حال پرس‌وجو تطبیق دارند وجود دارند. در ساده‌ترین شکل آن، فایل LMHosts یک آدرس IP و یک نام host را شامل می‌شود.
3. سومین مکانیزم حل که توسط کامپیوتر محلی برای حل نام NetBIOS استفاده می‌شود شامل مشاوره یک یا چند سرور نام. در اکثر موارد، سرور نامی که تماس گرفته می‌شود یک سرور نام‌گذاری اینترنت ویندوز (WINS) است. از نظر فنی، شما می‌توانستید یک سرور نام‌گذاری NetBIOS ایجاد کنید که یک سرور WINS نیست، اما به ندرست انجام می‌شود.
4. چهارمین و روش حل نهایی broadcast برای نام NetBIOS است. کامپیوتر یک بسته خاص broadcast می‌کند که توسط تمام ماشین‌ها در شبکه دریافت و پردازش می‌شود. بسته سپس درخواست می‌کند که کامپیوتر خود را شناسایی کند. این در داخل یک شبکه محلی موثر است اما در سراسر روترها که بسته‌های broadcast را ارسال نمی‌کنند نااثر است.

بنابراین اگر می‌خواهیم با سیستم عامل مایکروسافت ویندوز ارتباط برقرار کنیم نیاز داریم راهی پیدا کنیم که با این حل نام NetBios کار کند. سایر پروتکل که نیاز به توضیح کم و مرور دارد SMB است.

#### پروتکل SMB

پروتکل Block پیام سرور (پروتکل SMB) یک پروتکل ارتباط کلاینت-سرور است که برای اشتراک‌گذاری دسترسی به فایل‌ها، چاپگرها، پورت‌های سریال و سایر منابع در یک شبکه استفاده می‌شود. توسط آی‌بی‌ام در دهه 1980 ایجاد شد، پروتکل SMB از آن زمان تا به چندین نوع یا پیاده‌سازی‌ها، که همچنین به عنوان لهجه شناخته می‌شوند، برای برآوردن به نیازهای شبکه در حال تکامل طی سال‌ها زایش کرده است.

لهجه‌های پروتکل SMB : انواع پروتکل SMB قابلیت‌های پیاده‌سازی اصلی، مقیاس‌پذیری، امنیت و کارا را بهبود بخشیده‌اند. اینجا یک نمای کلی از لهجه‌های قابل توجه پروتکل SMB است:

* SMB 1.0 (1984): توسط IBM برای اشتراک‌گذاری فایل در DOS ایجاد شد.
* CIFS (1996): لهجه SMB توسعه‌یافته توسط مایکروسافت که در ویندوز 95 معرفی شد. پشتیبانی برای اندازه‌های فایل بزرگتر، انتقال مستقیم روی TCP/IP، و لینک‌های نمادیک و hard links اضافه شد.
* SMB 2.0 (2006): با ویندوز ویستا و سرور ویندوز 2008 منتشر شد.
* SMB 2.1 (2010): با سرور ویندوز 2008 R2 و ویندوز 7 معرفی شد.
* SMB 3.0 (2012): در ویندوز 8 و سرور ویندوز 2012 معرفی شد.

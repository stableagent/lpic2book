# 210.2. احراز هویت PAM

## **210.2 احراز هویت PAM**

**وزن:** 3

**توضیحات:** داوطلبان باید بتوانند PAM را طوری پیکربندی کنند که از روش‌های مختلف احراز هویت پشتیبانی کند. این هدف شامل آشنایی پایه با SSSD نیز می‌شود.

**نواحی کلیدی دانش:**

* فایل‌های پیکربندی PAM، مفاهیم و ابزارها
* فایل‌های passwd و shadow
* استفاده از sssd برای احراز هویت LDAP

**اصطلاحات و ابزارها:**

* /etc/pam.d/
* pam.conf
* nsswitch.conf
* pam_unix, pam_cracklib, pam_limits, pam_listfile, pam_sss
* sssd.conf

کنترل احراز هویت، authorization و account management در سیستم بسیار مهم است. در لینوکس منابع مختلفی برای احراز هویت وجود دارد؛ مثل فایل‌های محلی (`/etc/passwd` و `/etc/shadow`)، LDAP و سرویس‌های قدیمی‌تر مثل NIS. PAM برای یکسان‌سازی این فرآیندها به وجود آمده است.

## PAM چیست؟

PAM (Pluggable Authentication Modules) یک لایه انتزاعی بین برنامه‌ها (مثل `login`، `su`، `sudo`، `sshd` و ...) و مکانیزم‌های احراز هویت است. برنامه‌ها از طریق PAM درخواست احراز هویت/چک‌های account را انجام می‌دهند و PAM بر اساس ruleهای پیکربندی‌شده ماژول‌های لازم را اجرا می‌کند.

## ساختار فایل‌های PAM

در اغلب توزیع‌ها، پیکربندی PAM در مسیر `/etc/pam.d/` انجام می‌شود و برای هر سرویس یک فایل وجود دارد.

در نسخه‌های قدیمی‌تر ممکن است `/etc/pam.conf` استفاده می‌شد، اما این روش معمولاً deprecated است و فقط اگر `/etc/pam.d/` وجود نداشته باشد استفاده می‌شود.

## چهار نوع "facility" در PAM

در فایل‌های PAM معمولاً چهار ستون/نوع رایج دیده می‌شود:

* **auth**: احراز هویت (رمز عبور، کلید، توکن و ...)
* **account**: بررسی وضعیت account (انقضا، اجازه ورود و ...)
* **password**: تغییر رمز عبور
* **session**: کارهای زمان شروع/پایان session (mount، limits، log و ...)

## control flagها

برای هر خط، یک control flag تعیین می‌کند اگر ماژول موفق/ناموفق شد چه ادامه‌ای انجام شود. رایج‌ترین‌ها:

* `required`
* `requisite`
* `sufficient`
* `optional`

## ماژول‌های مهم

### pam_unix

برای احراز هویت محلی با استفاده از فایل‌های passwd/shadow.

### pam_cracklib / pam_pwquality

برای enforce کردن سیاست‌های رمز عبور (طول، پیچیدگی و ...). بسته به توزیع ممکن است نام ماژول متفاوت باشد.

### pam_limits

برای اعمال محدودیت‌های منابع از طریق `/etc/security/limits.conf`.

## SSSD و LDAP (آشنایی)

SSSD (System Security Services Daemon) می‌تواند برای اتصال سیستم به منابع مرکزی مثل LDAP/AD استفاده شود.

در سناریوهای LDAP معمولاً این فایل‌ها مهم هستند:

* `/etc/sssd/sssd.conf`
* `/etc/nsswitch.conf`

و ماژولی مثل `pam_sss` در PAM استفاده می‌شود.

## عیب‌یابی

* بررسی logها (auth.log یا journal)
* تست کردن syntax و ترتیب ruleها
* دقت به control flagها و اینکه ترتیب ruleها اهمیت دارد
